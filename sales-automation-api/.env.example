# ============================================================================
# Sales Automation MCP Server - Environment Variables
# ============================================================================
#
# Copy this file to .env and fill in your actual values
# NEVER commit .env to git (it's in .gitignore)
#
# Generate API keys with: node scripts/generate-api-key.js
#

# ----------------------------------------------------------------------------
# API Authentication
# ----------------------------------------------------------------------------
# Comma-separated list of valid API keys for server authentication
# Generate with: node scripts/generate-api-key.js --count 2
# Format: sk_live_<64 hex characters>
#
# SECURITY: Keep these keys secure! They grant full API access.
#
API_KEYS=sk_live_your_api_key_here,sk_live_another_key_here

# ----------------------------------------------------------------------------
# CORS Configuration
# ----------------------------------------------------------------------------
# Comma-separated list of allowed origins for CORS
# Examples: http://localhost:3000,https://yourdomain.com
#
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3456

# ----------------------------------------------------------------------------
# Server Configuration
# ----------------------------------------------------------------------------
# Port for the API server (default: 3000)
API_PORT=3000

# Node environment (development, staging, production)
NODE_ENV=development

# ----------------------------------------------------------------------------
# Claude API (for AI-powered workflows)
# ----------------------------------------------------------------------------
# Get your API key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key-here

# ----------------------------------------------------------------------------
# HubSpot CRM Integration
# ----------------------------------------------------------------------------
# Create a private app in HubSpot:
# Settings → Integrations → Private Apps → Create
# Required scopes: crm.objects.contacts.write, crm.objects.companies.write
HUBSPOT_ACCESS_TOKEN=pat-na1-your-hubspot-token-here

# ----------------------------------------------------------------------------
# Lemlist Outreach Integration
# ----------------------------------------------------------------------------
# Get your API key from: https://app.lemlist.com/settings/integrations
LEMLIST_API_KEY=your-lemlist-api-key-here

# Lemlist webhook secret for signature verification
# Configure this in Lemlist webhook settings
LEMLIST_WEBHOOK_SECRET=your-lemlist-webhook-secret-here

# ----------------------------------------------------------------------------
# Postmark Email Service
# ----------------------------------------------------------------------------
# Get your API key from: https://postmarkapp.com/
POSTMARK_API_KEY=your-postmark-api-key-here

# Postmark webhook secret for signature verification
# Configure this in Postmark webhook settings
POSTMARK_WEBHOOK_SECRET=your-postmark-webhook-secret-here

# ----------------------------------------------------------------------------
# Phantombuster LinkedIn Automation
# ----------------------------------------------------------------------------
# Get your API key from: https://phantombuster.com/
PHANTOMBUSTER_API_KEY=your-phantombuster-api-key-here

# Phantombuster webhook token for authentication
PHANTOMBUSTER_WEBHOOK_SECRET=your-phantombuster-webhook-token-here

# ----------------------------------------------------------------------------
# Explorium Data Enrichment
# ----------------------------------------------------------------------------
# Contact Explorium for API access: https://www.explorium.ai/
EXPLORIUM_API_KEY=your-explorium-api-key-here

# ----------------------------------------------------------------------------
# LinkedIn (Optional - for automated connection requests)
# ----------------------------------------------------------------------------
# Session cookie from LinkedIn (use with caution)
# WARNING: This violates LinkedIn ToS. Use at your own risk.
LINKEDIN_SESSION_COOKIE=your-linkedin-session-cookie-here

# ----------------------------------------------------------------------------
# YOLO Mode (Fully Autonomous Operation)
# ----------------------------------------------------------------------------
# Enable fully autonomous sales workflows (true/false)
YOLO_MODE=false

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------
# SQLite database location (relative to project root)
DATABASE_PATH=.sales-automation/database.db

# PostgreSQL Configuration (Phase 6+)
# ⚠️ SECURITY WARNING: Change these credentials in production!
# Default dev credentials are intentionally weak for local development
#
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=rtgs_sales_automation
POSTGRES_USER=rtgs_user
POSTGRES_PASSWORD=rtgs_password_dev
# For production, use strong passwords:
# - 20+ characters
# - Mix of uppercase, lowercase, numbers, symbols
# - Store in secure vault (AWS Secrets Manager, HashiCorp Vault)
# - Example: POSTGRES_PASSWORD=$(aws secretsmanager get-secret-value --secret-id prod/postgres/password)

# ----------------------------------------------------------------------------
# Redis Configuration (REQUIRED for Production)
# ----------------------------------------------------------------------------
# Redis URL for orphaned event queue persistence (Phase 2+)
# Format: redis://[username:password@]host:port[/db]
#
# Development (local Redis):
REDIS_URL=redis://localhost:6379
#
# Production (managed Redis service):
# AWS ElastiCache:    redis://master.my-cluster.abc123.use1.cache.amazonaws.com:6379
# Redis Cloud:        redis://:password@redis-12345.c123.us-east-1-1.ec2.cloud.redislabs.com:12345
# Azure Cache:        redis://:password@mycache.redis.cache.windows.net:6380
# Google Memorystore: redis://10.0.0.3:6379
#
# ⚠️ CRITICAL: Queue events are lost on restart without Redis!
# Production MUST use managed Redis service (AWS ElastiCache, Redis Cloud, etc.)
# DO NOT use in-memory fallback in production - data loss will occur!

# Orphaned event queue configuration
ORPHANED_QUEUE_MAX_SIZE=10000
ORPHANED_QUEUE_BATCH_SIZE=50

# ----------------------------------------------------------------------------
# Rate Limiting
# ----------------------------------------------------------------------------
# Maximum requests per IP per window (default: 100)
RATE_LIMIT_MAX=100

# Rate limit window in minutes (default: 15)
RATE_LIMIT_WINDOW=15

# ----------------------------------------------------------------------------
# Session Management (Stage 2: Security Enhancement)
# ----------------------------------------------------------------------------
# Session secret for cookie-based authentication (dashboard)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# CRITICAL: Use different secrets for dev/staging/production
SESSION_SECRET=your_session_secret_here_generate_with_crypto_randomBytes

# Session TTL (Time To Live) in milliseconds
# Default: 3600000 (1 hour)
SESSION_TTL=3600000

# Session cookie name
SESSION_COOKIE_NAME=rtgs_sales_session

# ----------------------------------------------------------------------------
# CSRF Protection (Stage 2: Security Enhancement)
# ----------------------------------------------------------------------------
# CSRF token secret for Double Submit Cookie pattern
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# CRITICAL: Use different secrets for dev/staging/production
CSRF_SECRET=your_csrf_secret_here_generate_with_crypto_randomBytes

# CSRF token rotation policy: per-session | per-request
# per-session: Token valid for entire session (lower overhead, recommended)
# per-request: Token regenerated after each use (maximum security)
CSRF_ROTATION=per-session

# CSRF token TTL in seconds (default: 3600 = 1 hour)
CSRF_TOKEN_TTL=3600

# CSRF enforcement mode (true = block requests, false = log warnings only)
# Set to false during migration, then enable once frontend is updated
CSRF_ENFORCE=true

# ----------------------------------------------------------------------------
# Webhook Signature Verification (Stage 2: Security Enhancement)
# ----------------------------------------------------------------------------
# IMPORTANT: Configure these secrets in your webhook provider settings
# These are used to verify HMAC-SHA256 signatures on incoming webhooks

# Lemlist webhook signing secret (obtain from Lemlist webhook settings)
LEMLIST_WEBHOOK_SECRET=your_lemlist_webhook_secret_from_dashboard

# Postmark webhook signing secret (obtain from Postmark webhook settings)
POSTMARK_WEBHOOK_SECRET=your_postmark_webhook_secret_from_dashboard

# Phantombuster webhook signing secret (obtain from Phantombuster settings)
PHANTOMBUSTER_WEBHOOK_SECRET=your_phantombuster_webhook_secret_from_dashboard

# Generic webhook signing secret (for custom webhooks)
WEBHOOK_SIGNING_SECRET=your_webhook_signing_secret_generate_with_crypto

# ----------------------------------------------------------------------------
# Account Lockout (Stage 2: Brute Force Prevention)
# ----------------------------------------------------------------------------
# Maximum failed login attempts before account lockout
LOCKOUT_MAX_ATTEMPTS=5

# Lockout duration in minutes (default: 15 minutes)
LOCKOUT_DURATION_MINUTES=15

# Lockout window in minutes (time frame for counting failed attempts)
LOCKOUT_WINDOW_MINUTES=15

# ----------------------------------------------------------------------------
# Logging
# ----------------------------------------------------------------------------
# Log level: error, warn, info, debug (default: info)
LOG_LEVEL=info

# Enable debug logging (true/false)
DEBUG=false

# Log security events to separate file (true/false)
LOG_SECURITY_EVENTS=true

# Security log file path (relative to project root)
SECURITY_LOG_PATH=logs/security.log

# ============================================================================
# SECURITY BEST PRACTICES (Stage 2 Enhanced)
# ============================================================================
#
# 1. Secret Generation:
#    • Generate secrets with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#    • Minimum entropy: 32 bytes (256 bits)
#    • NEVER use predictable secrets (e.g., "secret123", company name, etc.)
#
# 2. Secret Rotation:
#    • Rotate ALL secrets every 90 days minimum
#    • Rotate immediately if suspected compromise
#    • Use different secrets for dev/staging/production
#    • Document rotation dates in secure password manager
#
# 3. API Keys:
#    • Generate strong keys with: npm run generate-api-key
#    • Rotate keys every 90 days
#    • Use key rotation with grace period (48 hours recommended)
#    • Never share or commit keys to version control
#    • Monitor API key usage via audit logs
#
# 4. File Permissions:
#    • Set .env to 600 (read/write owner only)
#    • Run: chmod 600 .env
#    • Verify with: ls -la .env
#
# 5. Git Security:
#    • Verify .env is in .gitignore
#    • Run: git check-ignore .env (should return: .env)
#    • NEVER commit .env or any secrets to git
#    • Use git-secrets or gitleaks to prevent accidental commits
#
# 6. Production Deployment:
#    • DO NOT use .env files in production
#    • Use environment variables via:
#      - AWS Secrets Manager
#      - HashiCorp Vault
#      - Azure Key Vault
#      - Google Secret Manager
#    • Enable HTTPS/TLS (minimum TLS 1.2)
#    • Use strong TLS ciphers only
#    • Enable HSTS (Strict-Transport-Security header)
#
# 7. Webhook Security:
#    • ALWAYS verify HMAC-SHA256 signatures
#    • Reject webhooks with invalid signatures (403 Forbidden)
#    • Use different secrets for each webhook provider
#    • Log all webhook validation failures
#
# 8. Session Security:
#    • Set HttpOnly flag on cookies (prevents XSS theft)
#    • Set Secure flag in production (HTTPS only)
#    • Set SameSite=Strict (prevents CSRF)
#    • Use short session TTLs (1 hour recommended)
#    • Implement session fixation protection
#
# 9. CSRF Protection:
#    • Enable CSRF tokens for ALL state-changing operations (POST/PUT/DELETE/PATCH)
#    • Use Double Submit Cookie pattern
#    • Exempt only signature-verified webhooks
#    • Rotate tokens per-session or per-request
#
# 10. Monitoring & Alerting:
#     • Enable security event logging
#     • Monitor failed authentication attempts
#     • Alert on:
#       - Account lockouts
#       - Invalid CSRF tokens
#       - Failed webhook signature verifications
#       - Unusual API key usage patterns
#     • Review security logs daily
#
# ============================================================================
# SECURITY CHECKLIST (Complete before production deployment)
# ============================================================================
#
# [ ] All secrets generated with crypto.randomBytes(32)
# [ ] Different secrets for dev/staging/production
# [ ] .env file permissions set to 600
# [ ] .env added to .gitignore and verified
# [ ] Production secrets stored in secure vault (not .env)
# [ ] HTTPS/TLS enabled with valid certificate
# [ ] CSRF protection enabled (CSRF_ENFORCE=true)
# [ ] Webhook signature verification configured
# [ ] Rate limiting enabled (100 req/15min)
# [ ] Account lockout enabled (5 attempts/15min)
# [ ] Session cookies configured (HttpOnly, Secure, SameSite)
# [ ] Security logging enabled
# [ ] API key rotation policy documented
# [ ] Incident response plan prepared
# [ ] Security audit completed (OWASP Top 10)
#
# ============================================================================
